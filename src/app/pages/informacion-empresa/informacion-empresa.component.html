<!-- Loading indicator -->
<div *ngIf="isLoading" class="loading-container">
  <p>Cargando información de la empresa...</p>
</div>

<!-- Error message -->
<div *ngIf="error" class="error-container">
  <p>{{ error }}</p>
  <button (click)="refreshData()">Reintentar</button>
</div>

<div class="container" *ngIf="!isLoading && !error && empresa">
  <!-- Header Information -->
  <h2 class="main-title">INFORMACIÓN DE LA EMPRESA</h2>
  <div class="header-section">
            <h4 class="company-name">{{ empresa.nombre_comercial }}</h4>
    <button *ngIf="isCoformacionUser()" class="block-button" (click)="toggleBlockModal()">Bloquear Empresa</button>
  </div>

  <!-- Company Information -->
  <div class="company-section">
    <div class="company-logo">
      <img src="assets/logoEmpresa.png" alt="Logo de la empresa">
    </div>
    
    <div class="info-grid">
      <div class="info-item">
        <label>Nombre de la Empresa</label>
        <span>{{ empresa.nombre_comercial }}</span>
      </div>
      <div class="info-item">
        <label>NIT</label>
        <span>{{ empresa.nit }}</span>
      </div>
      <div class="info-item">
        <label>Sector Económico</label>
        <span>{{ getSectorNombre() }}</span>
      </div>
      <div class="info-item">
        <label>Tamaño de Empresa</label>
        <span>{{ getTamanoDescripcion() }}</span>
      </div>
      <div class="info-item">
        <label>ID de la Empresa</label>
        <span>{{ empresa.empresa_id }}</span>
      </div>
    </div>
  </div>

  <!-- Contact Information -->
  <div class="section-card" *ngIf="contactosEmpresa.length > 0">
    <h3 class="section-title">Información de Contacto</h3>
    <div class="contacts-grid">
      <div class="contact-item" *ngFor="let contacto of contactosEmpresa">
        <div class="contact-row">
          <div class="contact-field">
            <label>Nombre del Contacto</label>
            <span>{{ contacto.nombre }}</span>
          </div>
          <div class="contact-field">
            <label>Tipo de Contacto</label>
            <span>{{ getTipoContactoNombre(contacto.tipo) }}</span>
          </div>
        </div>
        <div class="contact-row">
          <div class="contact-field">
            <label>Correo Electrónico</label>
            <span>{{ contacto.email }}</span>
          </div>
          <div class="contact-field">
            <label>Teléfono</label>
            <span>{{ contacto.telefono }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Active Offers Section -->
  <div class="section-card" *ngIf="getOfertasActivas().length > 0">
    <h3 class="section-title">Ofertas Activas de Coformación</h3>
    <div class="offers-grid">
      <div class="offers-header">
        <div>Descripción</div>
        <div>Fecha Inicio</div>
        <div>Fecha Fin</div>
        <div>Estado</div>
      </div>
      <div class="offers-content">
        <div class="offers-row" *ngFor="let oferta of getOfertasActivas()">
          <div>{{ oferta.descripcion }}</div>
          <div>{{ oferta.fecha_inicio | date:'dd/MM/yyyy' }}</div>
          <div>{{ oferta.fecha_fin | date:'dd/MM/yyyy' }}</div>
          <div class="status-active">Activa</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Expired Offers Section -->
  <div class="section-card" *ngIf="getOfertasVencidas().length > 0">
    <h3 class="section-title">Ofertas Vencidas</h3>
    <div class="offers-grid">
      <div class="offers-header">
        <div>Descripción</div>
        <div>Fecha Inicio</div>
        <div>Fecha Fin</div>
        <div>Estado</div>
      </div>
      <div class="offers-content">
        <div class="offers-row" *ngFor="let oferta of getOfertasVencidas()">
          <div>{{ oferta.descripcion }}</div>
          <div>{{ oferta.fecha_inicio | date:'dd/MM/yyyy' }}</div>
          <div>{{ oferta.fecha_fin | date:'dd/MM/yyyy' }}</div>
          <div class="status-expired">Vencida</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary Statistics -->
  <div class="section-card">
    <h3 class="section-title">Estadísticas</h3>
    <div class="stats-grid">
      <div class="stat-item">
        <label>Total de Contactos</label>
        <span class="stat-number">{{ contactosEmpresa.length }}</span>
      </div>
      <div class="stat-item">
        <label>Ofertas Activas</label>
        <span class="stat-number active">{{ getOfertasActivas().length }}</span>
      </div>
      <div class="stat-item">
        <label>Ofertas Vencidas</label>
        <span class="stat-number expired">{{ getOfertasVencidas().length }}</span>
      </div>
      <div class="stat-item">
        <label>Total de Ofertas</label>
        <span class="stat-number">{{ ofertasEmpresa.length }}</span>
      </div>
    </div>
  </div>

  <!-- No Data Sections -->
  <div class="section-card" *ngIf="contactosEmpresa.length === 0">
    <h3 class="section-title">Información de Contacto</h3>
    <div class="no-data-message">
      <p>No hay contactos registrados para esta empresa.</p>
    </div>
  </div>

  <div class="section-card" *ngIf="ofertasEmpresa.length === 0">
    <h3 class="section-title">Ofertas de Coformación</h3>
    <div class="no-data-message">
      <p>No hay ofertas registradas para esta empresa.</p>
      <button class="create-offer-btn" (click)="publicarOferta()">
        Crear Primera Oferta
      </button>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button class="edit-button" (click)="editarEmpresa()">EDITAR EMPRESA</button>
    <button class="primary-button" (click)="publicarOferta()">PUBLICAR OFERTA</button>
    <button class="refresh-button" (click)="refreshData()">ACTUALIZAR</button>
    <button class="cancel-button" (click)="cancelar()">VOLVER</button>
  </div>
</div>

<!-- No data message -->
<div *ngIf="!isLoading && !error && !empresa" class="no-data-container">
  <p>No se encontró información de la empresa.</p>
  <button (click)="refreshData()">Reintentar</button>
</div>

<!-- Block Modal -->
<div class="modal-overlay" *ngIf="showBlockModal" (click)="toggleBlockModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <h2 class="modal-title">BLOQUEAR EMPRESA</h2>
    <p class="modal-message">
      ¿Está seguro de bloquear la empresa <strong>{{ empresa?.nombre_comercial }}</strong>?
    </p>
    <div class="modal-buttons">
      <button class="modal-button cancel" (click)="toggleBlockModal()" [disabled]="isBlocking">
        Cancelar
      </button>
      <button class="modal-button confirm" (click)="confirmBlock()" [disabled]="isBlocking">
        {{ isBlocking ? 'Bloqueando...' : 'Sí, seguro' }}
      </button>
    </div>
  </div>
</div>
